// GAS helper update (apply in Apps Script):
// Replace saveImageToDriveSafe with this version to set sharing and return a direct view URL.
function saveImageToDriveSafe(imageBase64, id) {
  if (!DRIVE_FOLDER_ID) return '';
  try {
    const folder = DriveApp.getFolderById(DRIVE_FOLDER_ID);
    const base64Data = (imageBase64.split(',')[1] || imageBase64).trim();
    const blob = Utilities.newBlob(Utilities.base64Decode(base64Data), 'image/jpeg', `${id}.jpg`);
    const file = folder.createFile(blob);
    file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
    return `https://drive.google.com/uc?export=view&id=${file.getId()}`;
  } catch (e) {
    throw new Error('이미지 저장에 실패했습니다: ' + (e && e.message ? e.message : e));
  }
}
